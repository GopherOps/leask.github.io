<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" type="text/css" href="style.css" /><title>Flora c&#94;2&#21457;&#24067;&#65281;&#24403;&#21069;&#27979;&#35797;&#29256;0.7</title></head><body><h1 id="blog-Title"><a href="index.html">&#35;import &#34;Leask.h&#34;</a></h1><div id="bp"><h2 id="bp-15BAC1A170471DB_15095-Title">Flora c&#94;2&#21457;&#24067;&#65281;&#24403;&#21069;&#27979;&#35797;&#29256;0.7</h2><h5 id="bp-15BAC1A170471DB_15095-publish">11/8/2009 5&#58;35&#58;41 PM</h5><div id="bp-15BAC1A170471DB_15095-content" class="blogpost"><p>程序员通常会遇到需要计算的时候，然而并不单单是加减乘除，我们需要带有表达式支持的计算功能。我想在*nix上没有比bc更加便利的了，但是bc有一点让我很压抑的就是bc的小数处理需要在每次进入bc的时候设置，十分不友好。于是就萌生了用shell脚本封装一下bc的想法。于是我封装出一个计算器[C]alculator。</p> <p>设计师常常有截取网页全图的需要，于是我曾撰文《在Mac上通过Terminal截取网页全图 / Full Page Screenshots by Terminal On a Mac》（URL：<a title="http&#58;//honeonet.spaces.live.com/blog/cns!15BAC1A170471DB!15092.entry" href="http&#58;//honeonet.spaces.live.com/blog/cns!15BAC1A170471DB!15092.entry">http&#58;//honeonet.spaces.live.com/blog/cns!15BAC1A170471DB!15092.entry</a>）提出通过webkit2png截取网页全图的方法。但是webkit2png使用也并不太便利：默认情况下每次使用都要求输入webkit2png脚本所在的位置，默认参数会输出3个尺寸的图片，默认参数下图片会存储在shell当前的工作目录（并不人性化），默认情况下不能识别“www.yourdomain.com”或者“yourdomain.net”这样的地址（webkit2png要求输入完整的，如“http&#58;//www.yourdomain.com”这样的地址），默认情况下webkit2png生成的文件名也不符合Mac上截图热键生成的带有时间信息的文件名的习惯……有没有办法让webkit2png更加聪明好用呢？于是我又把webkit2png封装了一下，得到一个Web Pages [C]atcher。</p> <p>昨晚突发奇想，把两个类似的脚本整合一下：</p> <blockquote> <p><em>[C]alculator * Web Pages [C]atcher = c * c = c ^2</em> </p></blockquote> <p>于是我把我的脚本命名为Flora c^2，主要是应付我的工作要求，顺便写出来分享给大家，希望也能为大家的工作提高一点点效率。</p> <p> 脚本需要你先下载好webkit2png，方法见我上面提到的文章，然后在脚本中注释掉以下这行，如：</p> <blockquote> <p><em># bitmapdata.representationUsingType_properties_(AppKit.NSPNGFileType,None).writeToFile_atomically_(filename + &quot;-full.png&quot;,objc.YES)  <font color="#ff8040">【去掉】</font></em></p></blockquote> <p>添加下面一行：</p> <blockquote> <p><em>bitmapdata.representationUsingType_properties_(AppKit.NSPNGFileType,None).writeToFile_atomically_(filename + &quot;.png&quot;,objc.YES)   <font color="#ff8040">【添加】</font></em></p></blockquote> <p>然后保存我下面的代码为shellscript，然后和webkit2png放在同一个文件夹，设置好文件夹和脚本的权限都是允许执行的，如果不和你的程序名称冲突，建议把文件名存为“c”（就一个小写c就好了，便于执行）。 // 注意了，别忘记你可能还需要把你的脚本文件夹添加到$PATH环境变量中！</p> <p>代码如下：</p> <blockquote> <p><em>#!/bin/bash<br />#################################################<br />#    Flora c^2 0.7<br />#################################################<br />#    What's c^2?<br />#    c^2 for [C]alculator &amp; Web Pages [C]atcher<br />#    Code by LeaskH.com<br />#    November 7, 2009<br />################################################# </em> <p><em>header ()<br />&#123;<br />    echo &quot;Flora c^2 0.7 by LeaskH.com // based on bc 1.06 &amp; webkit2png 0.5&quot;; echo &quot;&quot;;<br />&#125; </em> <p><em>fnwebkit2png()<br />&#123;<br />    python &quot;$(dirname &quot;$0&quot;)&quot;/webkit2png -W 1024 -H 768 -F -o &quot;Web shot `date &quot;+%Y-%m-%d at %H.%M.%S %p&quot;`&quot; -D &quot;~/Downloads&quot; $1; echo &quot;&quot;;<br />&#125; </em> <p><em>fnbcexec()<br />&#123;<br />    echo &quot;scale=7; $1&quot; | bc; echo &quot;&quot;;<br />&#125; </em> <p><em>calexec()<br />&#123;<br />    while true; do<br />        if [ -n &quot;$strfloratc&quot; ]; then<br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ] &amp;&amp; [ &quot;$strfloratc&quot; = &quot;h&quot;  ]; then<br />                echo &quot;Options include&#58;&quot;;<br />                echo &quot;  h    - This help file&quot;;<br />                echo &quot;  hb   - bc help file&quot;;    <br />                echo &quot;  hw   - webkit2png help file&quot;;        <br />                echo &quot;  c    - Clears the screen&quot;;<br />                echo &quot;  q    - Quits the program&quot;;<br />                echo &quot;&quot;;<br />                strfloratc=&quot;&quot;;<br />            fi<br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ] &amp;&amp; [ &quot;$strfloratc&quot; = &quot;hb&quot; ]; then bc -h; strfloratc=&quot;&quot;; fi<br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ] &amp;&amp; [ &quot;$strfloratc&quot; = &quot;hw&quot; ]; then fnwebkit2png --help; strfloratc=&quot;&quot;; fi<br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ] &amp;&amp; [ &quot;$strfloratc&quot; = &quot;q&quot; ]; then exit; fi<br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ] &amp;&amp; [ &quot;$strfloratc&quot; = &quot;c&quot; ]; then clear; header; strfloratc=&quot;&quot;; fi<br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ] &amp;&amp; [ &quot;$&#123;strfloratc&#58;0&#58;4&#125;&quot; = &quot;http&quot; ]; then fnwebkit2png $strfloratc; strfloratc=&quot;&quot;; fi<br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ] &amp;&amp; ([ &quot;$&#123;strfloratc&#58;0&#58;3&#125;&quot; = &quot;www&quot; ] || [ &quot;$&#123;strfloratc&#58;0&#58;3&#125;&quot; = &quot;wap&quot; ]); then fnwebkit2png </em><a href="http&#58;//$strfloratc;"><em>http&#58;//$strfloratc;</em></a><em> strfloratc=&quot;&quot;; fi<br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ] &amp;&amp; ([ &quot;$&#123;strfloratc&#58;(-3)&#58;3&#125;&quot; = &quot;com&quot; ] || [ &quot;$&#123;strfloratc&#58;(-3)&#58;3&#125;&quot; = &quot;net&quot; ]); then fnwebkit2png </em><a href="http&#58;//$strfloratc;"><em>http&#58;//$strfloratc;</em></a><em> strfloratc=&quot;&quot;; fi    <br />            if [ &quot;$strfloratc&quot; != &quot;&quot; ]; then fnbcexec $strfloratc; strfloratc=&quot;&quot;; fi<br />        fi<br />        if [ $1 = true ]; then<br />            read -p &quot;&quot; strfloratc;<br />            calexec true $strfloratc;<br />        else<br />            exit; <br />        fi<br />    done<br />&#125; </em> <p><em>header;<br />strfloratc=$1;<br />if [ -n &quot;$1&quot; ]; then<br />    calexec false;<br />else<br />    calexec true;<br />fi<br />exit 0;</em></p></blockquote> <p>ok，就那么简单。</p> <p>下面看看执行效果：<br /><img style="border-bottom&#58;0px;border-left&#58;0px;display&#58;inline;border-top&#58;0px;border-right&#58;0px" title="Screen shot 2009-11-08 at 5.18.47 PM" border="0" alt="Screen shot 2009-11-08 at 5.18.47 PM" src="img/15BAC1A170471DB_15095_0.jpg" width="585" height="617" /> <br />上图演示内容：</p> <ul> <li>通过 c + [空格] + [表达式] 直接计算；</li> <li>通过 c + [空格] + [网址] 截取网页全图；</li> <li>通过 c 启动程序，程序启动后，输入表达式直接计算，输入网址自动截取；</li> <li>查看Downloads文件夹，三张网页截图已经安静地呆在里面了。</li></ul> <p>文件名的设定我按照Mac的习惯设置，Mac上的图片截取文件名为：“Screen shot 2009-11-06 at 12.25.15 PM.png”，于是我设定的截图文件名为：“Web shot 2009-11-08 at 17.17.46 PM.png”。</p> <p>截图文件保存在<em>~/Downloads</em>文件夹。通过h命令查看程序帮助，通过q命令退出程序。</p> <p>由于最近很多工作需要查询SQLite，所以未来我可能在脚本上加入查询和写入SQLite的便捷功能，有相关需要的朋友请留意。</p>  </div><h3>Comments</h3><div id="bp-15BAC1A170471DB_15095-comments" class="comments"></div></div></body></html>