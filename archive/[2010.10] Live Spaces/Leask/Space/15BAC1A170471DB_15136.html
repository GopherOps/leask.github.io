<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" type="text/css" href="style.css" /><title>TextMate&#30340;&#19968;&#20010;&#23567;&#20860;&#23481;&#38382;&#39064;</title></head><body><h1 id="blog-Title"><a href="index.html">&#35;import &#34;Leask.h&#34;</a></h1><div id="bp"><h2 id="bp-15BAC1A170471DB_15136-Title">TextMate&#30340;&#19968;&#20010;&#23567;&#20860;&#23481;&#38382;&#39064;</h2><h5 id="bp-15BAC1A170471DB_15136-publish">12/24/2009 12&#58;25&#58;01 AM</h5><div id="bp-15BAC1A170471DB_15136-content" class="blogpost"><p>我手头有不少项目是用TextMate写的，虽然最近几天开始改用vim（改用vim主要是想保持一个统一的编辑环境，在Command Line和GUI之间。），在vim完全上手之前，还是需要用TextMate一段时间。</p> <p>今天工作的时候，遇到一个很奇怪的问题，我无法用Textmate的FTP/SSH插件（<a title="http&#58;//fuerstnet.de/en/ftp-ssh-bundle-textmate" href="http&#58;//fuerstnet.de/en/ftp-ssh-bundle-textmate" target="_blank">http&#58;//fuerstnet.de/en/ftp-ssh-bundle-textmate</a>）来上传程序到服务器。程序提示PHP错误：</p> <p><img src="http&#58;//t.leaskh.com/1mvf" /></p> <p>才知道原来TextMate的FTP/SSH插件是通过PHP环境上传和下载文件的。<br />考虑到前几天我配置了Snow Leopard本地的PHP环境体换掉了MAMP集成环境。于是考虑是不是本地的PHP环境和TextMate的插件环境不兼容。</p> <p>查看插件的源代码：</p> <blockquote> <p><em>……<br />usr/bin/env php <br />&lt;?php<br />// Initialize variables and load helper functions<br />require(<strong>$_ENV['TM_BUNDLE_SUPPORT'].</strong>'/lib/helper_functions.php'); <br />// put file to the remote host<br />put_file($_ENV['TM_FILENAME'], $_ENV['TM_FILEPATH'], $_ENV['TM_DIRECTORY'], $PROJECT_DIR, $PREFS);<br />……</em></p></blockquote> <p>不难看出TextMate通过PHP环境变量的方式传递变量给一个PHP Shell，然后由PHP Shell的Function()上传和下载文件。经过对php.ini的分析研究，发现原来php.ini中有关于环境变量的这一个描述：</p> <blockquote> <p><em>……<br />; This directive determines which super global arrays are registered when PHP<br />; starts up. If the register_globals directive is enabled, it also determines<br />; what order variables are populated into the global space. G,P,C,E &amp; S are<br />; abbreviations for the following respective super globals&#58; GET, POST, COOKIE,<br />; ENV and SERVER. There is a performance penalty paid for the registration of<br />; these arrays and because ENV is not as commonly used as the others, ENV is<br />; is not recommended on productions servers. You can still get access to<br />; the environment variables through getenv() should you need to.<br />; Default Value&#58; &quot;EGPCS&quot;<br />; Development Value&#58; &quot;GPCS&quot;<br />; Production Value&#58; &quot;GPCS&quot;;<br />; ……<br /><strong>variables_order = &quot;GPCS&quot;</strong><br />……</em></p></blockquote> <p>Snow Leopard在启用php.ini这个配置文件的时候，会更改PHP环境<strong>variables_order</strong>的默认值，然而这个设置将导致PHP定义全局环境变量的功能失效。于是尝试修改为：</p> <blockquote> <p><strong><em>variables_order = &quot;EGPCS&quot;</em></strong></p></blockquote> <p>重新加载插件：</p> <blockquote> <p><em>osascript -e 'tell app &quot;TextMate&quot; to reload bundles'</em></p></blockquote> <p>问题得到解决。 <p>注意，如果你使用Snow Leoprad并使用系统内置的PHP环境，而且你用TextMate+FTP/SSH Bundle，你将遇到和我一样的问题。虽然variables_order = &quot;EGPCS&quot;并不是PHP推荐的设置值，但是目前看来只能这样了。期待TextMate的后续版本能解决这个问题。</p>  </div><h3>Comments</h3><div id="bp-15BAC1A170471DB_15136-comments" class="comments"></div></div></body></html>