<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" type="text/css" href="style.css" /><title>Flora_ssh-D Version 2.33 &#38378;&#20142;&#30331;&#22330;&#65281;</title></head><body><h1 id="blog-Title"><a href="index.html">&#35;import &#34;Leask.h&#34;</a></h1><div id="bp"><h2 id="bp-15BAC1A170471DB_15080-Title">Flora_ssh-D Version 2.33 &#38378;&#20142;&#30331;&#22330;&#65281;</h2><h5 id="bp-15BAC1A170471DB_15080-publish">10/29/2009 11&#58;26&#58;29 AM</h5><div id="bp-15BAC1A170471DB_15080-content" class="blogpost"><p><img style="border-bottom&#58;0px;border-left&#58;0px;display&#58;inline;border-top&#58;0px;border-right&#58;0px" title="Screen shot 2009-10-29 at 10.10.21 AM" border="0" alt="Screen shot 2009-10-29 at 10.10.21 AM" src="img/15BAC1A170471DB_15080_0.jpg" width="640" height="458" /> </p> <p>Flora_ssh-D是什么？</p> <ol> <li>Flora_ssh-D是一个Applescript（以app形式封装），在Mac OS上开发和运行（有计划推出针对Windows的版本）；</li> <li>Flora_ssh-D是一个iTunes VoiveOver程序，能够像iPod shuffle那样自动报读当前正在播放的歌名和艺术家；</li> <li>Flora_ssh-D能够自动连接ssh -D服务器，自动创建Socks代理服务器，高速访问某些如Twitter、Facebook等国外优秀站点，并在连接断开的时候自动重连，配合ssh -D服务器使用，让Wall从此透明；</li> <li>Flora_ssh-D并不包含ssh -D服务器信息，如果你要使用第3条的功能，你需要自己购买ssh -D服务器，<strong>做有责任感的网民，网上行为务必符合国家法律法规</strong>；</li> <li>Flora_ssh-D能自动更新你的Twitter状态为你正在听的歌，如：【I am listening to #Sensible by #Sun Yan-Zi in album #Leave. // Thursday, October 29, 2009 11&#58;05&#58;32 AM】；</li> <li>Flora_ssh-D能自动记录你正在听的歌到Last.fm；</li> <li>Flora_ssh-D能自动更新你DNS-O-MATIC上的动态IP地址为你的当前IP；</li> <li>Flora_ssh-D能自动判断在线状态，自动为你开启和关闭某些软件；</li> <li><strong>推荐把Flora_ssh-D设置为开机启动，只需要在开机的时候执行这一个脚本，其他的程序可以配置到脚本里面，自动根据在线状态为你自动开启和关闭；</strong></li> <li>Flora_ssh-D是开源的自由软件，并已经在Google Code上创建为开源项目：<a href="http&#58;//code.google.com/p/flora-ssh-d/" target="_blank">http&#58;//code.google.com/p/flora-ssh-d/</a></li></ol> <p>Version 2.33有什么新改进？</p> <ol> <li>全新的任务调度，大大缩短iTunes VoiceOver的时间延迟；</li> <li>全新的配置方式，现在下载程序后无需配置就能马上执行，比较适合只需要iTunes VoiceOver功能的朋友；</li> <li>优化VoiceOver功能，添加音量淡入淡出功能，听起来效果更好，和iPod shuffle上基本上没有分别了；</li> <li>完善Twitter功能，自动在Twitter上发布你正在听的歌；</li> <li>完善last.fm歌曲记录功能；</li> <li>修正ssh -D连接的bug，让ssh -D连接更加顺畅，并在退出程序的时候自动关闭ssh –D以释放内存；</li> <li>进一步减少空闲时的资源占用，让脚本更轻巧，几乎感觉不到脚本的存在；</li> <li>全新的任务管理方式，运行更快，更稳定；</li> <li>添加中文配置说明，方便英文不好的朋友使用。</li></ol> <p><a title="Flora_ssh-D on Google Code" href="http&#58;//code.google.com/p/flora-ssh-d/" target="_blank">Flora_ssh-D</a> 2.33 能够在以下地址下载到：<a title="http&#58;//code.google.com/p/flora-ssh-d/downloads/list" href="http&#58;//code.google.com/p/flora-ssh-d/downloads/list" target="_blank">http&#58;//code.google.com/p/flora-ssh-d/downloads/list</a></p> <p> </p> <p>源代码如下：</p> <blockquote> <p>(* Flora_ssh-D Version 2.33<br />Open Source Project Home/开源项目主页&#58; <a href="http&#58;//code.google.com/p/flora-ssh-d/">http&#58;//code.google.com/p/flora-ssh-d/</a><br />Code by/程序编写&#58; 黄思夏 / Leask Huang<br />Blog&#58; <a href="http&#58;//www.leaskh.com">http&#58;//www.leaskh.com</a> (天朝访问需翻墙)<br />E-mail/GTalk/MSN/QQ&#58; i@leaskh.com *)  <p>(* CUSTOM THESE SETTINGS BEFORE YOUR RUN THINS SCRIPT // 运行此脚本前请先配置此区域的参数<br />    LEAVE IT BLANK IF YOU DON'T NEED IT // 如你不需要其中某些功能请将设置留空 *)<br />property SSHServerName &#58; &quot;&quot;<br />property SSHUserName &#58; &quot;&quot;<br />property SSHPasswd &#58; &quot;&quot;<br />property TwitterUsername &#58; &quot;&quot;<br />property TwitterPassword &#58; &quot;&quot;<br />property DNSUsername &#58; &quot;&quot;<br />property DNSPassword &#58; &quot;&quot;<br />property LastfmUsername &#58; &quot;&quot;<br />property LastfmPassword &#58; &quot;&quot;<br />property appStList &#58; &#123;&#125;<br />property appQuitList &#58; &#123;&#125;  <p>(* Example/示例 // English Help // 中文帮助 <br />property SSHServerName &#58; &quot;ssh.yourdomain.com&quot;   -- ssh -D Server Address (or leave it blank)  //  ssh -D 翻墙服务器地址 (不使用ssh -D则留空)<br />property SSHUserName &#58; &quot;*******&quot;   -- ssh -D User Name (or leave it blank)  //  ssh -D 帐号 (不使用ssh -D则留空)<br />property SSHPasswd &#58; &quot;*******&quot;   -- ssh -D Password (or leave it blank) //  ssh -D 密码 (不使用ssh -D则留空)<br />property TwitterUsername &#58; &quot;*******&quot;   -- Twitter User Name (or leave it blank)  //  Twitter帐号 (不使用Twitter则留空)<br />property TwitterPassword &#58; &quot;*******&quot;   -- Twitter Password (or leave it blank)  //  Twitter密码 (不使用Twitter则留空)<br />property DNSUsername &#58; &quot;*******&quot;   -- DNS User Name (or leave it blank)  //  DNS-O-MATIC动态IP帐号 (不使用动态IP则留空)<br />property DNSPassword &#58; &quot;*******&quot;   -- DNS Password (or leave it blank)  //  DNS-O-MATIC动态IP密码 (不使用动态IP则留空)<br />property LastfmUsername &#58; &quot;*******&quot;   -- last.fm User Name (or leave it blank)  // last.fm帐号 (不使用last.fm则留空)<br />property LastfmPassword &#58; &quot;*******&quot;   -- last.fm Password (or leave it blank)  //  last.fm密码 (不使用last.fm则留空)<br />property appStList &#58; &#123;&quot;App 1&quot;, &quot;软件2&quot;,&quot;iChat&quot;&#125;   -- these apps will launch while you are online (or leave it blank)  //  填写【在线】时需【开启】的软件(不使用此功能则留空)<br />property appQuitList &#58; &#123;&quot;App 1&quot;, &quot;软件2&quot;,&quot;QQ&quot;&#125;   -- these apps will quit while you are offline (or leave it blank)  //  填写【离线】时需【关闭】的软件(不使用此功能则留空)<br />*)  <p>(* ======= Variable Declaration ======= *)<br />global timeTry<br />global DNSResponse<br />global isOLast<br />global iTsCurDBID<br />global iTsORSoundVolume<br />global strSNGArtist<br />global strSNGName<br />global strSNGAlbum<br />global strSNGTrackNumber<br />global strSNGDuration<br />global intIdleCount  <p>(* ======= Main Script ======= *)<br />on run<br />    set isOLast to &quot;&quot;<br />    set iTsCurDBID to &quot;&quot;<br />    set intIdleCount to 10<br />end run  <p>on quit<br />    if isOLast is &quot;online&quot; then fnTwitter(&quot;I am offline now! // &quot; &amp; (current date), true)<br />    fnShellSSHEnd(true)<br />    fnAppQuit()<br />    continue quit<br />end quit  <p>on idle<br />    if fnCheckNet() is true then<br />        if intIdleCount &gt; 9 then<br />            fnSSHCnt()<br />            if isOLast is not &quot;online&quot; then<br />                fnAppStart()<br />                fnDNSUpdate()<br />                fnTwitter(&quot;I am online now! // &quot; &amp; (current date), true)<br />            end if<br />            set intIdleCount to 0<br />        end if<br />        fnMusic(true)<br />        set intIdleCount to intIdleCount + 1<br />        set isOLast to &quot;online&quot;<br />    else<br />        fnMusic(false)<br />        if isOLast is not &quot;offline&quot; then<br />            fnShellSSHEnd(true)<br />            fnAppQuit()<br />        end if<br />        set isOLast to &quot;offline&quot;<br />    end if<br />    return 33<br />end idle  <p>(* ======= Functions ======= *)<br />to fnCheckNet()<br />    try<br />        do shell script &quot;curl --connect-timeout 33 \&quot;apple.com/favicon.ico\&quot;&quot;<br />        if isOLast is not &quot;online&quot; then SmartSay(&#123;&quot;Online&quot;&#125;)<br />        return true<br />    on error<br />        if isOLast is not &quot;offline&quot; then SmartSay(&#123;&quot;Offline&quot;&#125;)<br />        return false<br />    end try<br />end fnCheckNet  <p>to fnAppStart()<br />    if (count appStList) &gt; 0 then<br />        SmartSay(&#123;&quot;Start Apps&quot;&#125;)<br />        try<br />            repeat with intSti from 1 to (count appStList)<br />                tell application (item intSti of appStList) to activate<br />            end repeat<br />            SmartSay(&#123;&quot;OK&quot;&#125;)<br />        on error<br />            SmartSay(&#123;&quot;Failed&quot;&#125;)<br />        end try<br />    end if<br />end fnAppStart  <p>to fnAppQuit()<br />    if (count appQuitList) &gt; 0 then<br />        SmartSay(&#123;&quot;Quit Applications&quot;&#125;)<br />        try<br />            repeat with intSti from 1 to count appQuitList<br />                tell application (item intSti of appQuitList) to quit<br />            end repeat<br />            SmartSay(&#123;&quot;OK&quot;&#125;)<br />        on error<br />            SmartSay(&#123;&quot;Failed&quot;&#125;)<br />        end try<br />    end if<br />end fnAppQuit  <p>to fnSSHCnt()<br />    if (length of SSHServerName) &gt; 0 and (length of SSHUserName) &gt; 0 and (length of SSHPasswd) &gt; 0 then<br />        set timeTry to 0<br />        repeat while fnCheckSSHD() is false<br />            SmartSay(&#123;&quot;Connect SSH D&quot;&#125;)<br />            if timeTry &gt; 0 then if (button returned of (display dialog &quot;ssh -D connection failed.&quot; &amp; return &amp; &quot;&quot; buttons &#123;&quot;Retry&quot;, &quot;Ignore&quot;&#125;)) is &quot;Ignore&quot; then exit repeat<br />            fnShellSSH()<br />            set timeTry to timeTry + 1<br />        end repeat<br />    end if<br />end fnSSHCnt  <p>to fnCheckSSHD()<br />    try<br />        do shell script &quot;curl --socks5 127.0.0.1&#58;7070 --connect-timeout 33 \&quot;apple.com/favicon.ico\&quot;&quot;<br />        if timeTry &gt; 0 then SmartSay(&#123;&quot;OK&quot;&#125;)<br />        return true<br />    on error<br />        if timeTry &gt; 0 then SmartSay(&#123;&quot;Failed&quot;&#125;)<br />        return false<br />    end try<br />end fnCheckSSHD  <p>to fnShellSSH()<br />    try<br />        try<br />            do shell script &quot;killall Terminal&quot;<br />        end try<br />        tell application &quot;Terminal&quot;<br />            activate<br />            fnShellSSHEnd(false) of me<br />            delay 1<br />            do script &quot;nohup ssh -D 7070 &quot; &amp; SSHUserName &amp; &quot;@&quot; &amp; SSHServerName &amp; &quot; &gt; Downloads/.Flora_ssh-D.out&quot; in window 1<br />        end tell<br />        SmartSay(&#123;&quot;SSH D connection request and log in request have been sent. Waiting for response from remote server.&quot;&#125;)<br />        tell application &quot;Terminal&quot;<br />            do script SSHPasswd in window 1<br />            delay 1<br />            quit<br />        end tell<br />    end try<br />end fnShellSSH  <p>to fnShellSSHEnd(isSay)<br />    if (length of SSHServerName) &gt; 0 and (length of SSHUserName) &gt; 0 and (length of SSHPasswd) &gt; 0 then<br />        if isSay is true then SmartSay(&#123;&quot;Disconnect SSH D&quot;&#125;)<br />        try<br />            do shell script &quot;killall ssh&quot;<br />            do shell script &quot;killall ssh-agent&quot;<br />            do shell script &quot;rm ~/Downloads/.Flora_ssh-D.out&quot;<br />        end try<br />    end if<br />end fnShellSSHEnd  <p>to fnTwitter(strTwText, isSay)<br />    if (length of TwitterUsername) &gt; 0 and (length of TwitterPassword) &gt; 0 and (length of strTwText) &gt; 0 then<br />        if (length of strTwText) &gt; 140 then<br />            set strTwText to (characters 1 through 137 of strTwText as string) &amp; &quot;...&quot;<br />        end if<br />        if isSay is true then SmartSay(&#123;&quot;Update Twitter state&quot;&#125;)<br />        try<br />            do shell script &quot;curl --connect-timeout 33  --user &quot; &amp; (quoted form of (TwitterUsername &amp; &quot;&#58;&quot; &amp; TwitterPassword)) &amp; &quot; --data-binary &quot; &amp; (quoted form of (&quot;status=&quot; &amp; strTwText)) &amp; &quot; \&quot;<a href="https&#58;//twitter.com/statuses/update.json\&quot;&quot;">https&#58;//twitter.com/statuses/update.json\&quot;&quot;</a><br />            if isSay is true then SmartSay(&#123;&quot;OK&quot;&#125;)<br />        on error<br />            if isSay is true then<br />                SmartSay(&#123;&quot;Failed&quot;&#125;)<br />            else<br />                SmartSay(&#123;&quot;Update Twitter state failed&quot;&#125;)<br />            end if<br />        end try<br />    end if<br />end fnTwitter  <p>to fnDNSShell()<br />    try<br />        set DNSResponse to (do shell script &quot;curl --connect-timeout 33 \&quot;<a href="https&#58;//&quot;">https&#58;//&quot;</a> &amp; DNSUsername &amp; &quot;&#58;&quot; &amp; DNSPassword &amp; &quot;@updates.dnsomatic.com/nic/update?&amp;wildcard=NOCHG&amp;mx=NOCHG&amp;backmx=NOCHG\&quot;&quot;)<br />        if first word of DNSResponse is &quot;good&quot; then -- (second word of DNSResponse) is IP address<br />            return true<br />        else<br />            return false<br />        end if<br />    on error<br />        return false<br />    end try<br />end fnDNSShell  <p>to fnDNSUpdate()<br />    if (length of DNSUsername) &gt; 0 and (length of DNSPassword) &gt; 0 then<br />        SmartSay(&#123;&quot;Update dynamic IP&quot;&#125;)<br />        if fnDNSShell() is true then<br />            SmartSay(&#123;&quot;OK&quot;&#125;)<br />        else<br />            SmartSay(&#123;&quot;Failed&quot;&#125;)<br />        end if<br />    end if<br />end fnDNSUpdate  <p>to fnURLec(strToUEC)<br />    return do shell script &quot;python -c 'import sys, urllib; print urllib.quote(sys.argv[1])' \&quot;&quot; &amp; strToUEC &amp; &quot;\&quot;&quot;<br />end fnURLec  <p>to fniTunesisActive()<br />    tell application &quot;System Events&quot; to return (name of processes contains &quot;iTunes&quot;)<br />end fniTunesisActive  <p>to fuisiTunesNUD()<br />    if fniTunesisActive() is true then<br />        tell application &quot;iTunes&quot;<br />            if player state is playing then<br />                set iTsNewDBID to (get database ID of current track)<br />                if iTsNewDBID is not iTsCurDBID then<br />                    set strSNGArtist to (get artist of current track)<br />                    set strSNGName to (get name of current track)<br />                    set strSNGAlbum to (get album of current track)<br />                    set strSNGTrackNumber to (get track number of current track)<br />                    set strSNGDuration to (get duration of current track as integer)<br />                    set iTsCurDBID to iTsNewDBID<br />                    return true<br />                else<br />                    return false<br />                end if<br />            else<br />                return false<br />            end if<br />        end tell<br />    else<br />        return false<br />    end if<br />end fuisiTunesNUD  <p>to SmartSay(strToSay)<br />    set isiTPing to false<br />    if fniTunesisActive() is true then<br />        tell application &quot;iTunes&quot; to if player state is playing then set isiTPing to true<br />    end if<br />    if isiTPing is true then<br />        tell application &quot;iTunes&quot;<br />            set iTsORSoundVolume to sound volume<br />            set timeTry to 0<br />            repeat while timeTry &lt; 10<br />                set timeTry to timeTry + 1<br />                set sound volume to iTsORSoundVolume * (15 - timeTry) / 15<br />                delay 0.1<br />            end repeat<br />        end tell<br />        repeat with intSti from 1 to (count strToSay)<br />            say &quot;&quot; &amp; (item intSti of strToSay)<br />            if intSti &lt; (count strToSay) then delay 1<br />        end repeat<br />        tell application &quot;iTunes&quot;<br />            set timeTry to 10<br />            repeat while timeTry &gt; 0<br />                set timeTry to timeTry - 1<br />                set sound volume to iTsORSoundVolume * (15 - timeTry) / 15<br />                delay 0.1<br />            end repeat<br />        end tell<br />    else<br />        say &quot;&quot; &amp; strToSay<br />    end if<br />end SmartSay  <p>to fnMusic(isOnline)<br />    if fuisiTunesNUD() is true then<br />        SmartSay(&#123;strSNGName, strSNGArtist&#125;)<br />        if isOnline is true then<br />            if (length of LastfmUsername) &gt; 0 and (length of LastfmPassword) &gt; 0 then<br />                try<br />                    do shell script &quot;curl --connect-timeout 33 \&quot;<a href="http&#58;//lastfmstats.livefrombmore.com/universalscrobbler/scrobble.php?submissionType=track&quot;">http&#58;//lastfmstats.livefrombmore.com/universalscrobbler/scrobble.php?submissionType=track&quot;</a> &amp; &quot;&amp;username=&quot; &amp; LastfmUsername &amp; &quot;&amp;password=&quot; &amp; LastfmPassword &amp; &quot;&amp;artist=&quot; &amp; fnURLec(strSNGArtist) &amp; &quot;&amp;track=&quot; &amp; fnURLec(strSNGName) &amp; &quot;&amp;album=&quot; &amp; fnURLec(strSNGAlbum) &amp; &quot;&amp;number=&quot; &amp; strSNGTrackNumber &amp; &quot;&amp;duration=&quot; &amp; strSNGDuration &amp; &quot;\&quot;&quot;<br />                on error<br />                    SmartSay(&#123;&quot;Scrobbling Failed&quot;&#125;)<br />                end try<br />                fnTwitter(&quot;I am listening to #&quot; &amp; strSNGName &amp; &quot; by #&quot; &amp; strSNGArtist &amp; &quot; in album #&quot; &amp; strSNGAlbum &amp; &quot;. // &quot; &amp; (current date), false)<br />            end if<br />        end if<br />    end if<br />end fnMusic</p></p></blockquote>  </div><h3>Comments</h3><div id="bp-15BAC1A170471DB_15080-comments" class="comments"><div id="comment-15BAC1A170471DB_15081"><h5 id="comment-15BAC1A170471DB_15081">&#19978;&#32593; &#25105;&#35201; - 10/29/2009 9&#58;10&#58;26 PM</h5>希望能开发linux版的Flora_ssh-D<br /></div></div></div></body></html>