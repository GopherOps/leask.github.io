---
layout: post
status: publish
published: true
title: Flora_ssh-D Version 2.47发布！&#47;&#47;主要修正：iTunes更新大量Podcast的时候脚本超时的Bug。
author:
  display_name: Leask
  login: leask
  email: i@leaskh.com
  url: http://www.leaskh.com
author_login: leask
author_email: i@leaskh.com
author_url: http://www.leaskh.com
wordpress_id: 47
wordpress_url: http://leaskh.wordpress.com/2009/11/16/flora_ssh-d-version-2-47%e5%8f%91%e5%b8%83%ef%bc%81%e4%b8%bb%e8%a6%81%e4%bf%ae%e6%ad%a3%ef%bc%9aitunes%e6%9b%b4%e6%96%b0%e5%a4%a7%e9%87%8fpodcast%e7%9a%84%e6%97%b6%e5%80%99%e8%84%9a%e6%9c%ac
date: '2009-11-16 10:27:18 +0800'
date_gmt: '2009-11-16 10:27:18 +0800'
categories:
- Uncategorized
tags: []
comments: []
---
<div id="msgcns!15BAC1A170471DB!15106" class="bvMsg">
<p>这个版本早就做好了，但是一直徘徊要不要放出来。因为这段时间我在尝试修改autossh的源代码。autossh是一个很优秀的开源项目，我希望build一个带有更完善翻墙功能的autossh版本，目前还是遇到很多问题。由于工作比较忙，可能一时三刻还完成不了，所以还是放出这个版本。这个版本对于一般的用户已经比较完美了，但是对于用Terminal比较多的用户，还是会有一点不适应的，因为脚本中连接ssh的时候会独占Terminal，这个问题我暂时还没有比较好的解决办法。<&#47;p>
<p>另外为了提高安全性，我尝试把各种用户名和密码保存在Mac的Keychain里面，但是不知道是不是因为Mac OS X 10.6.x中比较烦人的脚本安全规则作怪，脚本每次访问Keychain都需要弹出对话框让用户确认，所以最终还是放弃了这个做法，希望有解决办法的朋友指教一下。<&#47;p>
<p><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="Screen shot 2009-10-28 at 8.33.53 PM" border="0" alt="Screen shot 2009-10-28 at 8.33.53 PM" src="http:&#47;&#47;www.leaskh.com&#47;wp-content&#47;uploads&#47;2010&#47;09&#47;screenshot2009-10-28at8.png?w=300" width="640" height="355" &#47;><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="Screen shot 2009-10-28 at 8.34.34 PM" border="0" alt="Screen shot 2009-10-28 at 8.34.34 PM" src="http:&#47;&#47;www.leaskh.com&#47;wp-content&#47;uploads&#47;2010&#47;09&#47;screenshot2009-10-28at81.png?w=300" width="614" height="427" &#47;>&nbsp;<&#47;p>
<p>好了，不多说，最后还是放出源代码（和往常一样，我将在Google Code放出封装好的app和源代码，有需要的朋友直接去下载更新吧）：<&#47;p><br />
<blockquote>
<p><em>(* Flora_ssh-D Version 2.47<br &#47;>Open Source Project Home&#47;开源项目主页: <&#47;em><a href="http:&#47;&#47;code.google.com&#47;p&#47;flora-ssh-d&#47;"><em>http:&#47;&#47;code.google.com&#47;p&#47;flora-ssh-d&#47;<&#47;em><&#47;a><br &#47;><em>Code by&#47;程序编写: 黄思夏 &#47; Leask Huang<br &#47;>Blog: <&#47;em><a href="http:&#47;&#47;www.leaskh.com"><em>http:&#47;&#47;www.leaskh.com<&#47;em><&#47;a><em> (天朝访问需翻墙)<br &#47;>E-mail&#47;GTalk&#47;MSN&#47;QQ: i@leaskh.com *) <&#47;em><&#47;p>
<p><em>(* CUSTOM THESE SETTINGS BEFORE YOUR RUN THINS SCRIPT &#47;&#47; 运行此脚本前请先配置此区域的参数<br &#47;>&nbsp;&nbsp;&nbsp; LEAVE IT BLANK IF YOU DON'T NEED IT &#47;&#47; 如你不需要其中某些功能请将设置留空 *)<br &#47;>property SSHServerName : ""<br &#47;>property SSHUserName : ""<br &#47;>property SSHPasswd : ""<br &#47;>property TwitterUsername : ""<br &#47;>property TwitterPassword : ""<br &#47;>property DNSUsername : ""<br &#47;>property DNSPassword : ""<br &#47;>property LastfmUsername : ""<br &#47;>property LastfmPassword : ""<br &#47;>property appStList : &#123;&#125;<br &#47;>property appQuitList : &#123;&#125; <&#47;em>
<p><em>(* Example&#47;示例 &#47;&#47; English Help &#47;&#47; 中文帮助 <br &#47;>property SSHServerName : "ssh.yourdomain.com"&nbsp;&nbsp; -- ssh -D Server Address (or leave it blank)&nbsp; &#47;&#47;&nbsp; ssh -D 翻墙服务器地址 (不使用ssh -D则留空)<br &#47;>property SSHUserName : "*******"&nbsp;&nbsp; -- ssh -D User Name (or leave it blank)&nbsp; &#47;&#47;&nbsp; ssh -D 帐号 (不使用ssh -D则留空)<br &#47;>property SSHPasswd : "*******"&nbsp;&nbsp; -- ssh -D Password (or leave it blank) &#47;&#47;&nbsp; ssh -D 密码 (不使用ssh -D则留空)<br &#47;>property TwitterUsername : "*******"&nbsp;&nbsp; -- Twitter User Name (or leave it blank)&nbsp; &#47;&#47;&nbsp; Twitter帐号 (不使用Twitter则留空)<br &#47;>property TwitterPassword : "*******"&nbsp;&nbsp; -- Twitter Password (or leave it blank)&nbsp; &#47;&#47;&nbsp; Twitter密码 (不使用Twitter则留空)<br &#47;>property DNSUsername : "*******"&nbsp;&nbsp; -- DNS User Name (or leave it blank)&nbsp; &#47;&#47;&nbsp; DNS-O-MATIC动态IP帐号 (不使用动态IP则留空)<br &#47;>property DNSPassword : "*******"&nbsp;&nbsp; -- DNS Password (or leave it blank)&nbsp; &#47;&#47;&nbsp; DNS-O-MATIC动态IP密码 (不使用动态IP则留空)<br &#47;>property LastfmUsername : "*******"&nbsp;&nbsp; -- last.fm User Name (or leave it blank)&nbsp; &#47;&#47; last.fm帐号 (不使用last.fm则留空)<br &#47;>property LastfmPassword : "*******"&nbsp;&nbsp; -- last.fm Password (or leave it blank)&nbsp; &#47;&#47;&nbsp; last.fm密码 (不使用last.fm则留空)<br &#47;>property appStList : &#123;"App 1", "软件2","iChat"&#125;&nbsp;&nbsp; -- these apps will launch while you are online (or leave it blank)&nbsp; &#47;&#47;&nbsp; 填写【在线】时需【开启】的软件(不使用此功能则留空)<br &#47;>property appQuitList : &#123;"App 1", "软件2","QQ"&#125;&nbsp;&nbsp; -- these apps will quit while you are offline (or leave it blank)&nbsp; &#47;&#47;&nbsp; 填写【离线】时需【关闭】的软件(不使用此功能则留空)<br &#47;>*) <&#47;em>
<p><em>(* ======= Variable Declaration ======= *)<br &#47;>global timeTry<br &#47;>global DNSResponse<br &#47;>global isOLast<br &#47;>global iTsCurDBID<br &#47;>global iTsORSoundVolume<br &#47;>global strSNGArtist<br &#47;>global strSNGName<br &#47;>global strSNGAlbum<br &#47;>global strSNGTrackNumber<br &#47;>global strSNGDuration<br &#47;>global intIdleCount <&#47;em>
<p><em>(* ======= Main Script ======= *)<br &#47;>on run<br &#47;>&nbsp;&nbsp;&nbsp; set isOLast to ""<br &#47;>&nbsp;&nbsp;&nbsp; set iTsCurDBID to ""<br &#47;>&nbsp;&nbsp;&nbsp; set intIdleCount to 10<br &#47;>end run <&#47;em>
<p><em>on quit<br &#47;>&nbsp;&nbsp;&nbsp; with timeout of 3600 seconds<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is "online" then fnTwitter("I am offline now! &#47;&#47; " &amp; (current date), true)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnShellSSHEnd(true)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnAppQuit()<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; continue quit<br &#47;>&nbsp;&nbsp;&nbsp; end timeout<br &#47;>end quit <&#47;em>
<p><em>on idle<br &#47;>&nbsp;&nbsp;&nbsp; with timeout of 3600 seconds<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if fnCheckNet() is true then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if intIdleCount > 9 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnSSHCnt()<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is not "online" then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnAppStart()<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnDNSUpdate()<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnTwitter("I am online now! &#47;&#47; " &amp; (current date), true)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set intIdleCount to 0<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnMusic(true)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set intIdleCount to intIdleCount + 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set isOLast to "online"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnMusic(false)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is not "offline" then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnShellSSHEnd(true)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnAppQuit()<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set isOLast to "offline"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp; end timeout<br &#47;>&nbsp;&nbsp;&nbsp; return 60<br &#47;>end idle <&#47;em>
<p><em>(* ======= Functions ======= *)<br &#47;>to fnCheckNet()<br &#47;>&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "curl --connect-timeout 30 "apple.com&#47;favicon.ico""<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is not "online" then SmartSay(&#123;"Online"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true<br &#47;>&nbsp;&nbsp;&nbsp; on error<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOLast is not "offline" then SmartSay(&#123;"Offline"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br &#47;>&nbsp;&nbsp;&nbsp; end try<br &#47;>end fnCheckNet <&#47;em>
<p><em>to fnAppStart()<br &#47;>&nbsp;&nbsp;&nbsp; if (count appStList) > 0 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Start Apps"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat with intSti from 1 to (count appStList)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application (item intSti of appStList) to activate<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"OK"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on error<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Failed"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end fnAppStart <&#47;em>
<p><em>to fnAppQuit()<br &#47;>&nbsp;&nbsp;&nbsp; if (count appQuitList) > 0 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Quit Applications&quot<br />
;&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat with intSti from 1 to count appQuitList<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application (item intSti of appQuitList) to quit<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"OK"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on error<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Failed"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end fnAppQuit <&#47;em>
<p><em>to fnSSHCnt()<br &#47;>&nbsp;&nbsp;&nbsp; if (length of SSHServerName) > 0 and (length of SSHUserName) > 0 and (length of SSHPasswd) > 0 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set timeTry to 0<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat while fnCheckSSHD() is false<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Connect SSH D"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if timeTry > 0 then if (button returned of (display dialog "ssh -D connection failed." &amp; return &amp; "" buttons &#123;"Retry", "Ignore"&#125;)) is "Ignore" then exit repeat<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnShellSSH()<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set timeTry to timeTry + 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end fnSSHCnt <&#47;em>
<p><em>to fnCheckSSHD()<br &#47;>&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "curl --socks5 127.0.0.1:7070 --connect-timeout 30 "apple.com&#47;favicon.ico""<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if timeTry > 0 then SmartSay(&#123;"OK"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true<br &#47;>&nbsp;&nbsp;&nbsp; on error<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if timeTry > 0 then SmartSay(&#123;"Failed"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br &#47;>&nbsp;&nbsp;&nbsp; end try<br &#47;>end fnCheckSSHD <&#47;em>
<p><em>to fnShellSSH()<br &#47;>&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "killall Terminal"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "Terminal"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; activate<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnShellSSHEnd(false) of me<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do script "nohup ssh -D 7070 " &amp; SSHUserName &amp; "@" &amp; SSHServerName &amp; " > Downloads&#47;.Flora_ssh-D.out" in window 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"SSH D connection request and log in request have been sent. Waiting for response from remote server."&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "Terminal"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do script SSHPasswd in window 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quit<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br &#47;>&nbsp;&nbsp;&nbsp; end try<br &#47;>end fnShellSSH <&#47;em>
<p><em>to fnShellSSHEnd(isSay)<br &#47;>&nbsp;&nbsp;&nbsp; if (length of SSHServerName) > 0 and (length of SSHUserName) > 0 and (length of SSHPasswd) > 0 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isSay is true then SmartSay(&#123;"Disconnect SSH D"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "killall ssh"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "killall ssh-agent"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "rm ~&#47;Downloads&#47;.Flora_ssh-D.out"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end fnShellSSHEnd <&#47;em>
<p><em>to fnTwitter(strTwText, isSay)<br &#47;>&nbsp;&nbsp;&nbsp; if (length of TwitterUsername) > 0 and (length of TwitterPassword) > 0 and (length of strTwText) > 0 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (length of strTwText) > 140 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strTwText to (characters 1 through 137 of strTwText as string) &amp; "..."<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isSay is true then SmartSay(&#123;"Update Twitter state"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "curl --connect-timeout 30&nbsp; --user " &amp; (quoted form of (TwitterUsername &amp; ":" &amp; TwitterPassword)) &amp; " --data-binary " &amp; (quoted form of ("status=" &amp; strTwText)) &amp; " "<&#47;em><a href="https:&#47;&#47;twitter.com&#47;statuses&#47;update.json"""><em>https:&#47;&#47;twitter.com&#47;statuses&#47;update.json""<&#47;em><&#47;a><br &#47;><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isSay is true then SmartSay(&#123;"OK"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on error<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isSay is true then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Failed"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Update Twitter state failed"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end fnTwitter <&#47;em>
<p><em>to fnDNSShell()<br &#47;>&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set DNSResponse to (do shell script "curl --connect-timeout 30 "<&#47;em><a href="https:&#47;&#47;""><em>https:&#47;&#47;"<&#47;em><&#47;a><em> &amp; DNSUsername &amp; ":" &amp; DNSPassword &amp; "@updates.dnsomatic.com&#47;nic&#47;update?&amp;wildcard=NOCHG&amp;mx=NOCHG&amp;backmx=NOCHG"")<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if first word of DNSResponse is "good" then -- (second word of DNSResponse) is IP address<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp; on error<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br &#47;>&nbsp;&nbsp;&nbsp; end try<br &#47;>end fnDNSShell <&#47;em>
<p><em>to fnDNSUpdate()<br &#47;>&nbsp;&nbsp;&nbsp; if (length of DNSUsername) > 0 and (length of DNSPassword) > 0 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Update dynamic IP"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if fnDNSShell() is true then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"OK"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Failed"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end fnDNSUpdate <&#47;em>
<p><em>to fnURLec(strToUEC)<br &#47;>&nbsp;&nbsp;&nbsp; return do shell script "python -c 'import sys, urllib; print urllib.quote(sys.argv[1])' "" &amp; strToUEC &amp; """<br &#47;>end fnURLec <&#47;em>
<p><em>to fniTunesisActive()<br &#47;>&nbsp;&nbsp;&nbsp; tell application "System Events" to return (name of processes contains "iTunes")<br &#47;>end fniTunesisActive <&#47;em>
<p><em>to fuisiTunesNUD()<br &#47;>&nbsp;&nbsp;&nbsp; if fniTunesisActive() is true then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if player state is playing then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set iTsNewDBID to (get database ID of current track)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if iTsNewDBID is not iTsCurDBID then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGArtist to (get artist of current track)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGName to (get name of current track)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGAlbum to (get album of current track)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGTrackNumber to (get track number of current track)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set strSNGDuration to (get duration of current track as integer)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set iTsCurDBID to iTsNewDBID<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br &#47;>&nbsp;&nbsp;&nbsp; else<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end fuisiTunesNUD <&#47;em>
<p><em>to SmartSay(strToSay)<br &#47;>&nbsp;&nbsp;&nbsp; set isiTPing to false<br &#47;>&nbsp;&nbsp;&nbsp; if fniTunesisActive() is true then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes" to if player state is playing then set isiTPing to true<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp; if isiTPing is true then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set iTsORSoundVolume to sound volume<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set timeTry to 0<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat while timeTry < 10<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set timeTry to timeTry + 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set sound volume to iTsORSoundVolume *<br />
 (15 - timeTry) &#47; 15<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay 0.1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat with intSti from 1 to (count strToSay)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say "" &amp; (item intSti of strToSay)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if intSti < (count strToSay) then delay 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tell application "iTunes"<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set timeTry to 10<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat while timeTry > 0<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set timeTry to timeTry - 1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set sound volume to iTsORSoundVolume * (15 - timeTry) &#47; 15<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay 0.1<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end repeat<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end tell<br &#47;>&nbsp;&nbsp;&nbsp; else<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; say "" &amp; strToSay<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end SmartSay <&#47;em>
<p><em>to fnMusic(isOnline)<br &#47;>&nbsp;&nbsp;&nbsp; if fuisiTunesNUD() is true then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;strSNGName, strSNGArtist&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if isOnline is true then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (length of LastfmUsername) > 0 and (length of LastfmPassword) > 0 then<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do shell script "curl --connect-timeout 30 "<&#47;em><a href="http:&#47;&#47;lastfmstats.livefrombmore.com&#47;universalscrobbler&#47;scrobble.php?submissionType=track""><em>http:&#47;&#47;lastfmstats.livefrombmore.com&#47;universalscrobbler&#47;scrobble.php?submissionType=track"<&#47;em><&#47;a><em> &amp; "&amp;username=" &amp; LastfmUsername &amp; "&amp;password=" &amp; LastfmPassword &amp; "&amp;artist=" &amp; fnURLec(strSNGArtist) &amp; "&amp;track=" &amp; fnURLec(strSNGName) &amp; "&amp;album=" &amp; fnURLec(strSNGAlbum) &amp; "&amp;number=" &amp; strSNGTrackNumber &amp; "&amp;duration=" &amp; strSNGDuration &amp; """<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on error<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SmartSay(&#123;"Scrobbling Failed"&#125;)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end try<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fnTwitter("I am listening to #" &amp; strSNGName &amp; " by #" &amp; strSNGArtist &amp; " in album #" &amp; strSNGAlbum &amp; ". &#47;&#47; " &amp; (current date), false)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end if<br &#47;>&nbsp;&nbsp;&nbsp; end if<br &#47;>end fnMusic<&#47;em><&#47;p><&#47;p><&#47;p><&#47;blockquote>  <&#47;div></p>
