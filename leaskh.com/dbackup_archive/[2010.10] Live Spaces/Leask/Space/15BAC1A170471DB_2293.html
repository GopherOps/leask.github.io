<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" type="text/css" href="style.css" /><title>&#27605;&#19994;&#35774;&#35745; DEMO_2 &#22320;&#22270;&#26174;&#31034;&#27169;&#22359; &#28304;&#30721;&#20998;&#20139;</title></head><body><h1 id="blog-Title"><a href="index.html">&#35;import &#34;Leask.h&#34;</a></h1><div id="bp"><h2 id="bp-15BAC1A170471DB_2293-Title">&#27605;&#19994;&#35774;&#35745; DEMO_2 &#22320;&#22270;&#26174;&#31034;&#27169;&#22359; &#28304;&#30721;&#20998;&#20139;</h2><h5 id="bp-15BAC1A170471DB_2293-publish">1/26/2008 6&#58;07&#58;58 PM</h5><div id="bp-15BAC1A170471DB_2293-content" class="blogpost"><div>以下程序使用 MS VB6 SP6 English Edition 完成，最新版本加入地图切片显示的功能。</div>
<div>注意地图切片矩阵尚未实现拖动时的再组合，这也是今晚工作的重点了。</div>
<div> </div>
<div>'=============================================================<br />'地图显示模块 DEMO 2<br />'<br />'设计/编程&#58; 黄思夏<br />'Design/Program&#58; Leask Huang<br />'Copyfree (C) 2008 Leask Huang<br />'<br />'==============================================================</div>
<div><br />Option Explicit   '强制声明变量<br />Dim Map_Left As Integer   '地图切片左界限<br />Dim Map_Right As Integer   '地图切片右界限<br />Dim Map_Up As Integer   '地图切片上界限<br />Dim Map_Down As Integer   '地图切片下界限<br />Dim Cur_City_Name As String   '当前城市<br />Dim Map_Cou_Width As Long<br />Dim Map_Cou_Height As Long<br />Dim Map_Bas_X As Long<br />Dim Map_Bas_Y As Long<br />Dim Map_Cur_X As Long<br />Dim Map_Cur_Y As Long<br />Dim Map_Max_W As Long<br />Dim Map_Max_H As Long<br />Dim Map_Move_X As Integer<br />Dim Map_Move_Y As Integer</div>
<div> </div>
<div>Private Sub Map_Exp(X As Long, Y As Long)<br />Dim Show_X As Long<br />Dim Show_Y As Long<br />Dim Cell_X As Long<br />Dim Cell_Y As Long<br />Dim ix As Integer<br />Dim iy As Integer<br />Dim iDx As Integer<br />Dim iDy As Integer<br />Dim i As Integer</div>
<div> </div>
<div>If X &lt; 0 Or X &gt; Map_Max_W Or Y &lt; 0 Or Y &gt; Map_Max_H Then Exit Sub</div>
<div>Map_Image(0).Top = 0<br />Map_Image(0).Left = 0</div>
<div>Map_Image(1).Top = 0<br />Map_Image(1).Left = 300</div>
<div>Map_Image(2).Top = 0<br />Map_Image(2).Left = 600</div>
<div>Map_Image(3).Top = 0<br />Map_Image(3).Left = 900</div>
<div>Map_Image(4).Top = 300<br />Map_Image(4).Left = 0</div>
<div>Map_Image(5).Top = 300<br />Map_Image(5).Left = 300</div>
<div>Map_Image(6).Top = 300<br />Map_Image(6).Left = 600</div>
<div>Map_Image(7).Top = 300<br />Map_Image(7).Left = 900</div>
<div>Map_Image(8).Top = 600<br />Map_Image(8).Left = 0</div>
<div>Map_Image(9).Top = 600<br />Map_Image(9).Left = 300</div>
<div>Map_Image(10).Top = 600<br />Map_Image(10).Left = 600</div>
<div>Map_Image(11).Top = 600<br />Map_Image(11).Left = 900</div>
<div>Show_X = X<br />Show_Y = Y</div>
<div>Cell_X = Show_X \ 300<br />Cell_Y = Show_Y \ 300</div>
<div>If Show_X - Cell_X * 300 &lt; 150 Then<br />iDx = -2<br />Else<br />iDx = -1<br />End If</div>
<div>If Show_Y - Cell_Y * 300 &lt; 150 Then<br />iDy = -1<br />Else<br />iDy = 0<br />End If</div>
<div>For iy = 0 To 2<br />    For ix = 0 To 3<br />        Load_Map_Image Cell_X + ix - iDx, Cell_Y + iy - iDy, i<br />        i = i + 1<br />    Next<br />Next</div>
<div>ix = (Map_Frm.Width - 1200) / 2 - (Show_X - Cell_X * 300)<br />iy = (Map_Frm.Height - 900) / 2 - (Show_Y - Cell_Y * 300)</div>
<div>For i = 0 To 11<br />Map_Image(i).Left = Map_Image(i).Left + ix<br />Map_Image(i).Top = Map_Image(i).Top + iy<br />Next<br />End Sub</div>
<div> </div>
<div>Private Sub Map_Init()<br />Dim i As Integer<br />For i = 0 To 11<br />Map_Image(i).Stretch = False<br />Map_Image(i).Width = 300<br />Map_Image(i).Height = 300<br />Next</div>
<div>Map_Bas_X = 22753<br />Map_Bas_Y = 39284</div>
<div>Map_Cou_Width = 171 - 1<br />Map_Cou_Height = 106 - 1</div>
<div>Map_Max_W = Map_Cou_Width * 300<br />Map_Max_H = Map_Cou_Height * 300</div>
<div>Cur_City_Name = &quot;Shenzhen&quot;<br />End Sub</div>
<div> </div>
<div>Private Function Get_Map_Path()   '获得当前城市的地图数据路径<br />Get_Map_Path = App.Path &amp; &quot;\Library\Maps\&quot; &amp; Cur_City_Name &amp; &quot;\&quot;<br />End Function</div>
<div>Private Function Get_Map_Image(X As Integer, Y As Integer)   '获得地图切片路径<br />Dim temp_Path As String<br />temp_Path = Get_Map_Path &amp; (Y + Map_Bas_Y) &amp; &quot;\&quot; &amp; (Y + Map_Bas_Y) &amp; &quot;_&quot; &amp; (X + Map_Bas_X) &amp; &quot;.bmp&quot;<br />Dim FSO As New FileSystemObject<br />If FSO.FileExists(temp_Path) = False Then temp_Path = App.Path &amp; &quot;\Library\Images\space.bmp&quot;<br />Get_Map_Image = temp_Path<br />End Function</div>
<div> </div>
<div>Private Sub Load_Map_Image(X As Integer, Y As Integer, Map_Image_ID As Integer)   '加载地图切片<br />Map_Image(Map_Image_ID).Picture = LoadPicture(Get_Map_Image(X, Y))<br />End Sub</div>
<div>Private Sub Form_Load()<br />Map_Init<br />Map_Exp 9800, 8000<br />End Sub</div>
<div> </div>
<div>Private Sub Map_Image_MouseDown(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)<br />If Button = 1 Then<br />Map_Move_X = X<br />Map_Move_Y = Y<br />End If<br />End Sub</div>
<div> </div>
<div>Private Sub Map_Image_MouseMove(Index As Integer, Button As Integer, Shift As Integer, X As Single, Y As Single)<br />Me.Caption = X &amp; &quot; &quot; &amp; Y<br />Dim i As Integer<br />If Button = 1 Then<br />    For i = 0 To 11<br />        Map_Image(i).Left = Map_Image(i).Left + (X - Map_Move_X) / 15<br />        Map_Image(i).Top = Map_Image(i).Top + (Y - Map_Move_Y) / 15<br />    Next<br />End If<br />End Sub</div></div><h3>Comments</h3><div id="bp-15BAC1A170471DB_2293-comments" class="comments"></div></div></body></html>